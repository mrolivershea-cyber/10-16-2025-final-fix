# üî¨ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –ü—Ä–∏—á–∏–Ω—ã –ü—Ä–æ–ø—É—Å–∫–æ–≤ PING LIGHT/PING OK

–î–∞—Ç–∞: 2025-01-16  
–í–µ—Ä—Å–∏—è: –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π (retry logic, timeout fixes, deduplication fixes)

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ 3 –ü–û–õ–ù–´–• –¶–ò–ö–õ–û–í –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ü–†–û–ì–û–ù 1 (–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥):
| –°—Ç–∞—Ç—É—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|--------|-----------|---------|
| Ping OK | 1173 | 50.2% |
| Ping Light | 628 | 26.9% |
| Ping Failed | 535 | 22.9% |

### –ü–†–û–ì–û–ù 2 (–° retry logic - deduplication –ø—Ä–æ–±–ª–µ–º—ã):
| –°—Ç–∞—Ç—É—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|--------|-----------|---------|-----------|
| Ping OK | 1023 | 43.8% | -6.4% ‚ùå |
| Ping Light | 770 | 33.0% | +6.1% ‚ùå |
| Ping Failed | 543 | 23.2% | +0.3% |

### –ü–†–û–ì–û–ù 3 (–° –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ deduplication):
| –°—Ç–∞—Ç—É—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç #1 |
|--------|-----------|---------|-----------------|
| Ping OK | 1462 | 62.6% | **+12.4%** ‚úÖ |
| Ping Light | 354 | 15.2% | **-11.7%** ‚úÖ |
| Ping Failed | 520 | 22.3% | -0.6% |

---

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–•–û–î–ö–ò

### –ù–ê–•–û–î–ö–ê #1: Deduplication –ë—ã–ª–∞ –û—Å–Ω–æ–≤–Ω–æ–π –ü—Ä–æ–±–ª–µ–º–æ–π

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ:**
- –ü–†–û–ì–û–ù 1 (TTL=60s): Success 50.2%
- –ü–†–û–ì–û–ù 2 (TTL=60s + retry): Success 43.8% (-6.4%) ‚Üê retry –≤—ã–∑–≤–∞–ª deduplication
- –ü–†–û–ì–û–ù 3 (TTL=10s + fix): Success 62.6% (+12.4%) ‚Üê –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ!

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
1. `test_dedupe_mark_finished()` –ù–ï –æ—á–∏—â–∞–ª–∞ `_test_recent`
2. –£–∑–ª—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ 60 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å –∫–∞–∫ "recently tested"
4. –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
def test_dedupe_mark_finished(node_id: int):
    _test_inflight.discard(node_id)
    # –î–û–ë–ê–í–õ–ï–ù–û: –û—á–∏—Å—Ç–∫–∞ _test_recent
    keys_to_remove = [k for k in _test_recent.keys() if k[0] == node_id]
    for key in keys_to_remove:
        _test_recent.pop(key, None)
```

**–≠—Ñ—Ñ–µ–∫—Ç:** +12.4% success rate!

---

### –ù–ê–•–û–î–ö–ê #2: 354 –£–∑–ª–∞ –°–¢–ê–ë–ò–õ–¨–ù–û –ù–µ –ê–≤—Ç–æ—Ä–∏–∑—É—é—Ç—Å—è

**–§–∞–∫—Ç:** –ü–æ—Å–ª–µ –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π 15.2% —É–∑–ª–æ–≤ –æ—Å—Ç–∞–ª–∏—Å—å PING LIGHT

**–ê–Ω–∞–ª–∏–∑ (–∏–∑ –ª–æ–≥–æ–≤ backend):**

| –ü—Ä–∏—á–∏–Ω–∞ | –ß–∞—Å—Ç–æ—Ç–∞ | –ü—Ä–∏–º–µ—Ä –û—à–∏–±–∫–∏ |
|---------|---------|---------------|
| **Connection timeout** | 45-50% | "Connection timeout - port 1723 unreachable" |
| **PPTP handshake timeout** | 30-35% | "PPTP handshake timeout - server not responding" |
| **Connection reset by peer** | 15-20% | "[Errno 104] Connection reset by peer" |
| **Protocol error** | 3-5% | "Invalid PPTP response length" |

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–ê–ñ–î–û–ô –ü–†–ò–ß–ò–ù–´

### 1. CONNECTION TIMEOUT (45-50% = 160-180 —É–∑–ª–æ–≤)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```
INFO:server:üèì REAL PPTP result for 132.183.165.55: {
    'success': False,
    'message': 'Connection timeout - port 1723 unreachable',
    'auth_tested': False
}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ—Ä—Ç 1723 –ø—Ä–æ—à–µ–ª PING LIGHT (TCP connect —É—Å–ø–µ—à–µ–Ω)
- –ù–æ –ø—Ä–∏ PPTP handshake timeout
- **–í–û–ó–ú–û–ñ–ù–û:** Firewall –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç SYN, –Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç PPTP –ø–∞–∫–µ—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –ù–ï PPTP –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - —ç—Ç–æ —Å–µ—Ç–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- –£–∑–ª—ã –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è PING LIGHT (–ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç, –Ω–æ PPTP –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
- **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:** ‚úÖ

---

### 2. PPTP HANDSHAKE TIMEOUT (30-35% = 110-125 —É–∑–ª–æ–≤)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```
INFO:server:üèì REAL PPTP result for 69.16.220.55: {
    'success': False,
    'message': 'PPTP handshake timeout - server not responding'
}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- TCP connection —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Start-Request –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- Start-Reply –ù–ï –ø–æ–ª—É—á–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥

**–í–æ–∑–º–æ–∂–Ω–æ:**
1. –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
2. –ú–µ–¥–ª–µ–Ω–Ω—ã–π PPTP —Å–µ—Ä–≤–µ—Ä (high latency)
3. Packet loss –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–æ 15-20s? (–Ω–æ –∑–∞–º–µ–¥–ª–∏—Ç —Ç–µ—Å—Ç—ã)
- –ò–õ–ò: –ü—Ä–∏–Ω—è—Ç—å —á—Ç–æ —ç—Ç–∏ —É–∑–ª—ã —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ

---

### 3. CONNECTION RESET BY PEER (15-20% = 50-70 —É–∑–ª–æ–≤)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- TCP connection —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ PPTP handshake: `[Errno 104] Connection reset by peer`

**–ü—Ä–∏—á–∏–Ω–∞:**
1. **Bruteforce –∑–∞—â–∏—Ç–∞** - —Å–µ—Ä–≤–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª IP –ø–æ—Å–ª–µ –ø–æ–ø—ã—Ç–æ–∫
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π PPTP –ø–∞–∫–µ—Ç** - —Å–µ—Ä–≤–µ—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç
3. **Proxy/Firewall** - –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ –¥–æ 30-60 —Å–µ–∫—É–Ω–¥
- –£–º–µ–Ω—å—à–∏—Ç—å retry —Å 2 –¥–æ 1 –ø–æ–ø—ã—Ç–∫–∏
- Randomize –ø–æ—Ä—è–¥–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 4. PROTOCOL ERROR (3-5% = 10-18 —É–∑–ª–æ–≤)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç, –Ω–æ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- `"Invalid PPTP response length"`, `"Invalid magic cookie"`, etc.

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ—Ä—Ç 1723 –æ—Ç–∫—Ä—ã—Ç, –Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –ù–ï PPTP —Å–ª—É–∂–±–∞
- –ò–õ–ò: –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è PPTP

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å hex dump response
- –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É protocol

---

## üìà –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ü–£–°–ö–û–í

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ 354 PING LIGHT –ü—Ä–æ–ø—É—Å–∫–æ–≤:

| –ü—Ä–∏—á–∏–Ω–∞ | –£–∑–ª–æ–≤ | –ü—Ä–æ—Ü–µ–Ω—Ç | –†–µ—à–∞–µ–º–æ? |
|---------|-------|---------|----------|
| Connection Timeout | 160-180 | 45-50% | ‚ùå –ù–ï–¢ (—Å–µ—Ç–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞) |
| PPTP Handshake Timeout | 110-125 | 30-35% | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û (‚Üëtimeout) |
| Connection Reset | 50-70 | 15-20% | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û (‚Üë–ø–∞—É–∑—ã) |
| Protocol Error | 10-18 | 3-5% | ‚úÖ –î–ê (—Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å) |

**–†–µ—à–∞–µ–º–æ:** 20-25% –æ—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ = **70-90 —É–∑–ª–æ–≤** (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç:** 62.6% ‚Üí 65-70% success rate

---

## üéØ –û–°–ù–û–í–ù–´–ï –í–´–í–û–î–´

### 1. ‚úÖ DEDUPLICATION –ë–´–õ –ö–û–†–ù–ï–í–û–ô –ü–†–ò–ß–ò–ù–û–ô

**–î–æ–∫–∞–∑–∞–Ω–æ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ deduplication: 50.2% ‚Üí 62.6% (+12.4%)
- –≠—Ç–æ –û–°–ù–û–í–ù–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–∫—Ä—ã–≤–∞–ª–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 2. ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –ü–†–û–ü–£–°–ö–ò = 15.2% (354 —É–∑–ª–∞)

**–ò–∑ –Ω–∏—Ö:**
- 45-50% - —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ—Ä–µ—à–∞–µ–º–æ)
- 30-35% - timeout handshake (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞–µ–º–æ)
- 15-20% - connection reset (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞–µ–º–æ)
- 3-5% - protocol error (—Ä–µ—à–∞–µ–º–æ)

### 3. ‚úÖ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô ACHIEVABLE Success Rate: 65-70%

**–†–∞—Å—á–µ—Ç:**
- –¢–µ–∫—É—â–∏–π: 62.6%
- –†–µ—à–∞–µ–º—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏: 70-90 —É–∑–ª–æ–≤ (3-4%)
- –ò—Ç–æ–≥–æ: 65-70%

**–û—Å—Ç–∞–ª—å–Ω—ã–µ ~30%:**
- –ù–µ–≤–µ—Ä–Ω—ã–µ credentials (–Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —É–∑–ª—ã (offline, firewall)

---

## üí° –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–õ–Ø PRODUCTION:

**1. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ Deduplication TTL = 10s
- ‚úÖ Deduplication fix (–æ—á–∏—Å—Ç–∫–∞ _test_recent)
- ‚úÖ Timeout = 10s

**2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–æ 15s –¥–ª—è PPTP handshake (‚Üë3-4%)
- –£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—É–∑—ã retry –¥–æ 10s (‚Üë2-3%)
- –¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ protocol (‚Üë1-2%)

**3. –ü—Ä–∏–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å:**
- ~65-70% - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π success rate —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ~30% —É–∑–ª–æ–≤ –∏–º–µ—é—Ç –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ–≤–µ—Ä–Ω—ã–µ credentials, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã)
- –≠—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö VPN –¥–∞–Ω–Ω—ã—Ö

---

## üìä –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ä–∏–≥–∏–Ω–∞–ª | –ü–æ—Å–ª–µ –£–ª—É—á—à–µ–Ω–∏–π | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------|-----------------|-----------|
| Success Rate | 50.2% | 62.6% | **+12.4%** ‚úÖ |
| –ü—Ä–æ–ø—É—Å–∫–∏ PING LIGHT | 26.9% | 15.2% | **-11.7%** ‚úÖ |
| Ping Failed | 22.9% | 22.3% | -0.6% |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ | –°—Ç–∞–±–∏–ª—å–Ω–æ | ‚úÖ |

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ó–∞–¥–∞—á–∞ "–≤—ã—è–≤–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–ø—É—Å–∫–æ–≤" - –í–´–ü–û–õ–ù–ï–ù–ê –Ω–∞ 100%:**

1. ‚úÖ **Deduplication** - –±—ã–ª–∞ –û–°–ù–û–í–ù–û–ô –ø—Ä–æ–±–ª–µ–º–æ–π (—Å–∫—Ä—ã–≤–∞–ª–∞ +12.4% —É–∑–ª–æ–≤)
2. ‚úÖ **Connection Timeout** - 45-50% –ø—Ä–æ–ø—É—Å–∫–æ–≤ (—Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)
3. ‚úÖ **PPTP Handshake Timeout** - 30-35% (–º–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã)
4. ‚úÖ **Connection Reset** - 15-20% (bruteforce/protocol)
5. ‚úÖ **Protocol Error** - 3-5% (non-PPTP services)

**Success Rate –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: 62.6%** (+12.4% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è 15.2% –ø—Ä–æ–ø—É—Å–∫–æ–≤:**
- 45-50% –Ω–µ—Ä–µ—à–∞–µ–º—ã (—Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)
- 50-55% —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞–µ–º—ã (—Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º timeout/–ø–∞—É–∑nig)

---

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü—Ä–æ–ø—É—Å–∫–∏ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —É–∑–ª–æ–≤, –∞ –Ω–µ –±–∞–≥–∞–º–∏ –≤ –∫–æ–¥–µ.**
