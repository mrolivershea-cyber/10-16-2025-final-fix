# –ü–õ–ê–ù –£–õ–£–ß–®–ï–ù–ò–ô –ù–ê –û–°–ù–û–í–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

**–î–∞—Ç–∞:** 2025-01-10  
**–ù–∞ –æ—Å–Ω–æ–≤–µ:** –ü–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è 2336 —É–∑–ª–æ–≤

---

## üìä –í–´–Ø–í–õ–ï–ù–ù–´–ï –û–ë–õ–ê–°–¢–ò –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. PING LIGHT Timeout - –ì–∏–±–∫–æ—Å—Ç—å ‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Timeout=2s —Ö–∞—Ä–¥–∫–æ–¥ –≤ –∫–æ–¥–µ
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- 30% failed —É–∑–ª–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å timeout=5s

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å preset –≤—ã–±–æ—Ä –≤ UI:
```
Fast (2s) - 78% success, 62 —Å–µ–∫
Balanced (3s) - 80-82% success, 90 —Å–µ–∫  
Thorough (5s) - 85-88% success, 150 —Å–µ–∫
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è (15 –º–∏–Ω)

---

### 2. Retry Failed –º–µ—Ö–∞–Ω–∏–∑–º ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 4% failed —É–∑–ª–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π retry –ª–æ–≥–∏–∫–∏ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º timeout

**–†–µ—à–µ–Ω–∏–µ –ê: –ö–Ω–æ–ø–∫–∞ "Retry Failed"**
```javascript
<button onClick={retryFailed}>
  üîÑ Retry Failed (with 5s timeout)
</button>
```

**–†–µ—à–µ–Ω–∏–µ –ë: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry**
```javascript
// –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞:
if (failedCount > 0) {
  showRetryPrompt("Retry 530 failed nodes with longer timeout?")
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è (30 –º–∏–Ω)

---

### 3. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Failed —É–∑–ª–æ–≤ ‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç –ü–û–ß–ï–ú–£ —É–∑–ª—ã failed
- –ù–µ—Ç breakdown –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å breakdown:
```
PING FAILED: 506 —É–∑–ª–æ–≤
  - Timeout (2s): ~405 (80%)
    ‚Ä¢ Offline: ~200
    ‚Ä¢ Slow (>2s): ~150
    ‚Ä¢ Network: ~55
  - Connection Refused: ~101 (20%)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è (60 –º–∏–Ω)

---

### 4. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Timeout –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ ‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£–∑–ª—ã —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º –≤—ã—Å–æ–∫–∏–º ping —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è —Å –∫–æ—Ä–æ—Ç–∫–∏–º timeout
- –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –î–ª—è —É–∑–ª–æ–≤ —Å last_ping > 1500ms
if node.last_ping and node.last_ping > 1500:
    timeout = 5.0  # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π
else:
    timeout = 2.0  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è (30 –º–∏–Ω)

---

### 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Speed Test ‚≠ê‚≠ê‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏—è, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É–∑–ª—ã –≤—Å—ë –µ—â—ë –º–µ–¥–ª–µ–Ω–Ω—ã–µ (3-5 —Å–µ–∫)
- –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ

**–†–µ—à–µ–Ω–∏–µ:**
–£–º–µ–Ω—å—à–∏—Ç—å default sample_kb:
```javascript
// –ë—ã–ª–æ: 32 KB
const [speedSampleKB, setSpeedSampleKB] = useState(16);  // 16 KB

// –ë—ã—Å—Ç—Ä–µ–µ, –Ω–æ –≤—Å—ë –µ—â—ë –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê –ù–∏–∑–∫–∞—è (5 –º–∏–Ω)

---

### 6. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PING OK ‚≠ê‚≠ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- PING OK —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –¥–ª—è –º–Ω–æ–≥–∏—Ö —É–∑–ª–æ–≤
- –¢–µ–∫—É—â–∏–π concurrency –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
–£–≤–µ–ª–∏—á–∏—Ç—å concurrency –¥–ª—è PING OK:
```javascript
// –ë—ã–ª–æ: concurrency –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Ç–µ—Å—Ç–∞
// –°—Ç–∞–ª–æ: PING OK –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
if (testType === 'ping_ok') {
  concurrency = 50;  // –ë—ã–ª–æ ~20
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê –ù–∏–∑–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê –ù–∏–∑–∫–∞—è (5 –º–∏–Ω)

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠–¢–ê–ü 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (45 –º–∏–Ω)

1. ‚úÖ **Retry Failed –º–µ—Ö–∞–Ω–∏–∑–º** (30 –º–∏–Ω)
   - –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "Retry Failed" –≤ UI
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å timeout=5s
   
2. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Speed Test** (15 –º–∏–Ω)
   - –£–º–µ–Ω—å—à–∏—Ç—å default sample_kb –¥–æ 16 KB
   - –î–æ–±–∞–≤–∏—Ç—å preset –≤—ã–±–æ—Ä (Fast/Balanced/Thorough)

---

### –≠–¢–ê–ü 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (30 –º–∏–Ω)

3. ‚úÖ **PING LIGHT Timeout –≤—ã–±–æ—Ä** (15 –º–∏–Ω)
   - Preset –≤—ã–±–æ—Ä –≤ UI (Fast/Balanced/Thorough)
   
4. ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Timeout** (15 –º–∏–Ω)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å last_ping –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è timeout

---

### –≠–¢–ê–ü 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 60+ –º–∏–Ω)

5. ‚ö†Ô∏è **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (60 –º–∏–Ω)
   - Backend: –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–∏–ø –æ—à–∏–±–∫–∏ (timeout/refused/other)
   - Frontend: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å breakdown
   
6. ‚ö†Ô∏è **UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** (30 –º–∏–Ω)
   - –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
   - –¢—É–ª—Ç–∏–ø—ã —Å –¥–µ—Ç–∞–ª—è–º–∏

---

## üí° –ú–û–ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨ –°–ï–ô–ß–ê–° (–≠–¢–ê–ü 1):

**1. Retry Failed –º–µ—Ö–∞–Ω–∏–∑–º** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç 20-150 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤
- –£–ª—É—á—à–∏—Ç UX (–Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é)
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**2. Speed Test –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** ‚≠ê‚≠ê‚≠ê‚≠ê
- –£—Å–∫–æ—Ä–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 2 —Ä–∞–∑–∞
- –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∞–Ω–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å thorough –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

### –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨ –ü–û–ó–ñ–ï (–≠–¢–ê–ü 2):

**3. PING LIGHT Timeout –≤—ã–±–æ—Ä** ‚≠ê‚≠ê‚≠ê
- –î–∞—Å—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –£–ª—É—á—à–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ Thorough

**4. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Timeout** ‚≠ê‚≠ê‚≠ê
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—é

---

### –ü–†–û–ü–£–°–¢–ò–¢–¨ (–≠–¢–ê–ü 3):

**5-6. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** ‚≠ê‚≠ê
- Nice-to-have –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
- –ú–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –£–õ–£–ß–®–ï–ù–ò–ï 1: Retry Failed Mechanism

**Backend (server.py):**
–£–∂–µ –≥–æ—Ç–æ–≤–æ - –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ failed —É–∑–ª–∞—Ö.

**Frontend (TestingModal.js):**
```javascript
// –î–æ–±–∞–≤–∏—Ç—å state
const [showRetryPrompt, setShowRetryPrompt] = useState(false);
const [retryCount, setRetryCount] = useState(0);

// –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
if (progress.status === 'completed' && stats.ping_failed > 0) {
  setShowRetryPrompt(true);
}

// –ö–Ω–æ–ø–∫–∞ Retry
{showRetryPrompt && (
  <div className="bg-yellow-50 p-4 rounded">
    <p>‚ö†Ô∏è {stats.ping_failed} —É–∑–ª–æ–≤ failed. Retry —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º timeout?</p>
    <button onClick={() => retryFailed(5)}>
      üîÑ Retry Failed (5s timeout)
    </button>
  </div>
)}

// –§—É–Ω–∫—Ü–∏—è retry
const retryFailed = async (timeout) => {
  const failedIds = await getFailedNodeIds();
  startTest(failedIds, { timeout: timeout });
};
```

---

### –£–õ–£–ß–®–ï–ù–ò–ï 2: Speed Test Optimization

**Frontend (TestingModal.js):**
```javascript
// –ò–∑–º–µ–Ω–∏—Ç—å default
const [speedSampleKB, setSpeedSampleKB] = useState(16);  // –ë—ã–ª–æ 32

// –î–æ–±–∞–≤–∏—Ç—å preset
<div className="flex gap-2">
  <button onClick={() => setSpeedSampleKB(8)}>Fast (8KB)</button>
  <button onClick={() => setSpeedSampleKB(16)}>Balanced (16KB)</button>
  <button onClick={() => setSpeedSampleKB(32)}>Thorough (32KB)</button>
</div>
```

---

### –£–õ–£–ß–®–ï–ù–ò–ï 3: PING LIGHT Timeout Presets

**Frontend (TestingModal.js):**
```javascript
// –î–æ–±–∞–≤–∏—Ç—å preset –¥–ª—è timeout
<div className="preset-buttons">
  <button onClick={() => setPingLightTimeout(2)}>
    Fast (2s) - 78% success
  </button>
  <button onClick={() => setPingLightTimeout(3)}>
    Balanced (3s) - 82% success
  </button>
  <button onClick={() => setPingLightTimeout(5)}>
    Thorough (5s) - 88% success
  </button>
</div>
```

---

### –£–õ–£–ß–®–ï–ù–ò–ï 4: Adaptive Timeout

**Backend (server.py):**
```python
async def testing_batch(...):
    for node in nodes:
        # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π timeout –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
        if node.last_ping and node.last_ping > 1500:
            node_timeout = max(timeout, 5.0)  # –ú–∏–Ω–∏–º—É–º 5s –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö
        else:
            node_timeout = timeout
        
        result = await test_with_timeout(node, node_timeout)
```

---

## üéØ –ò–¢–û–ì–û

**–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –°–ï–ô–ß–ê–°:**
1. ‚úÖ Retry Failed –º–µ—Ö–∞–Ω–∏–∑–º
2. ‚úÖ Speed Test –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (sample_kb=16 default)
3. ‚úÖ PING LIGHT Timeout presets

**–í—Ä–µ–º—è:** ~45 –º–∏–Ω—É—Ç  
**–≠—Ñ—Ñ–µ–∫—Ç:** +5-10% —É—Å–ø–µ—à–Ω—ã—Ö —É–∑–ª–æ–≤, –±—ã—Å—Ç—Ä–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û—Ç–ª–æ–∂–∏—Ç—å:**
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (nice-to-have)
- UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (nice-to-have)

**–ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?**
